import{r as t,g as e}from"./phaser-CLYd3JIB.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var s=t();const i=e(s);class n extends s.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class a extends s.Scene{constructor(){super("Game")}create(){this.cameras.main.setBackgroundColor(65280),this.add.image(512,384,"background").setAlpha(.5),this.add.text(512,384,"Make something fun!\nand share it with us:\nsupport@phaser.io",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("GameOver")}))}}var r=[{mapkey:"floor1",player:{x:887,y:586},npcs:[],timer:30,backgroundmusic:"bgm",objectives:[{title:"Get your keys",type:1,key:"keys",required:!0,score:100}]},{mapkey:"floor2",player:{x:1606,y:730},npcs:[{sound:"Karam",npc_name:"karam",video_name:"karam_cutscene"}],timer:90,backgroundmusic:"bgm",objectives:[{title:"Get your keys",type:1,key:"keys",required:!0,score:100},{title:"Get your game jam duck",type:1,key:"duck",required:!0,score:100}]},{mapkey:"floor3",player:{x:3312,y:2e3},npcs:[{sound:"Karam",npc_name:"karam",video_name:"karam_cutscene"},{sound:"Farah",npc_name:"farah",video_name:"farah_cutscene"},{sound:"Rida",npc_name:"rida",video_name:"rida_cutscene"},{sound:"Yasser",npc_name:"yasser",video_name:"yasser_cutscene"},{sound:"Tala",npc_name:"tala",video_name:"tala_cutscene"}],timer:300,backgroundmusic:"bgm",objectives:[{title:"Get your first key",type:1,key:"key1",required:!0,score:100},{title:"Get your second key",type:1,key:"key2",required:!0,score:100},{title:"Get your first game jam duck",type:1,key:"duck1",required:!1,score:100},{title:"Get your second game jam duck",type:1,key:"duck2",required:!1,score:100},{title:"Get your first لوزة",type:1,key:"lozz1",required:!1,score:100},{title:"Get your second لوزة",type:1,key:"lozz2",required:!1,score:100}]}];class o extends i.Events.EventEmitter{constructor(){super(),this.maxFloors=r.length,this.submitted=!1,this.on("game-over",(t=>{this.score=0,this.currentFloor=1,this.pretendBusyUses=3,this.madDashUses=3})),this.on("floor-cleared",(t=>{this.score+=t.score}))}startGame(t){console.log("starting new game"),this.currentFloor=1,this.pretendBusyUses=3,this.madDashUses=3,this.score=0,t.scene.start("FloorScene",{floor:1})}nextFloor(){console.log("this.currentFloor.",this.currentFloor),console.log("this.maxFloors.",this.maxFloors),this.currentFloor<this.maxFloors?setTimeout((()=>{this.currentFloor++,this.emit("floor-started",{floor:this.currentFloor})}),1e3):(this.emit("game-won"),this.submitLeaderboardAttempt(),this.currentScene.scene.start("GameWon"))}setScene(t){this.currentScene=t}getFloorData(t){return r[t-1]}submitLeaderboardAttempt(){if(this.submitted)return;this.submitted=!0;const t={username:localStorage.getItem("username")||"Unknown",score:this.score};fetch("https://159.89.49.190:3000/api/v1/leaderboard/submit-attempt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((t=>{console.log("Submitted to leaderboard:",t)})).catch((t=>{console.error("Failed to submit score:",t)}))}}const h=o=new o;class l extends s.Scene{constructor(){super("GameOver")}create(){this.add.image(0,0,"background").setDisplaySize(this.scale.width,this.scale.height).setOrigin(0,0).setScrollFactor(0),this.add.text(.5*this.scale.width,.5*this.scale.height,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.gameOverMusic=this.sound.add("game_over",{loop:!0}),this.gameOverMusic.play(),this.events.on("shutdown",this.stopGameOverMusic,this),this.events.on("destroy",this.stopGameOverMusic,this),this.input.once("pointerdown",(()=>{console.log("Reloading window..."),window.location.reload()}))}stopGameOverMusic(){this.gameOverMusic&&this.gameOverMusic.stop()}}class d{constructor(t,e,s){this.scene=t,this.speed=300,this.width=98,this.height=130,this.pretendBusyUsesLeft=h.pretendBusyUses,this.maddashUsesLeft=h.madDashUses,this.busy=!1,this.dashing=!1,this.sprite=t.physics.add.sprite(e,s,"run-right"),this.busyTone=this.scene.sound.add("vocal_cute_angry",{loop:!1}),this.pretendBusyText=t.add.text(t.scale.width-20,80,"",{fontFamily:"Arial Black",fontSize:52,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(1,0).setScrollFactor(0),this.phone=this.scene.add.image(.05*t.scale.width,.65*t.scale.height,"phone").setScale(2).setInteractive().on("pointerdown",(()=>this.pretendBusy())),t.input.keyboard.on("keydown-W",(()=>this.pretendBusy())),this.pretendBusyText.setText(`Pretend busy: ${this.pretendBusyUsesLeft} left`),this.dashingTone=this.scene.sound.add("dashing",{loop:!1}),this.madDashText=t.add.text(t.scale.width-20,130,"",{fontFamily:"Arial Black",fontSize:52,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(1,0).setScrollFactor(0),this.maddashSprite=this.scene.add.image(.05*t.scale.width,.75*t.scale.height,"run").setScale(2).setInteractive().on("pointerdown",(()=>this.madDash())),t.input.keyboard.on("keydown-E",(()=>this.madDash())),this.madDashText.setText(`Mad dash: ${this.maddashUsesLeft} left`),this.scene.cameras.main.ignore([this.phone,this.maddashSprite]),this.sprite.setDepth(2),this.sprite.setCollideWorldBounds(!0),this.sprite.setDisplaySize(this.width,this.height),this.sprite.setBodySize(230,430),this.spotted=!1,this.sprite.anims.create({key:"stand-right",frames:this.scene.anims.generateFrameNames("stand-right",{prefix:"Standing_",start:0,end:14,zeroPad:5}),frameRate:25,repeat:-1}),this.sprite.anims.create({key:"stand-left",frames:this.scene.anims.generateFrameNames("stand-left",{prefix:"Standing_",start:0,end:14,zeroPad:5}),frameRate:25,repeat:-1}),this.sprite.anims.create({key:"run-right",frames:this.scene.anims.generateFrameNames("run-right",{prefix:"Running_",start:0,end:9,zeroPad:5}),frameRate:25,repeat:-1}),this.sprite.anims.create({key:"run-left",frames:this.scene.anims.generateFrameNames("run-left",{prefix:"Running_",start:0,end:9,zeroPad:5}),frameRate:25,repeat:-1}),this.joystickBase=t.add.circle(0,0,90,8947848).setScrollFactor(0),this.joystickThumb=t.add.circle(0,0,50,13421772).setScrollFactor(0),this.joystick=t.plugins.get("rexVirtualJoystick").add(t,{x:.85*t.scale.width,y:.65*t.scale.height,radius:90,base:this.joystickBase,thumb:this.joystickThumb}),this.cursors=t.input.keyboard.createCursorKeys(),this.running=t.sound.add("running",{loop:!0,spatial:!0})}disableInput(){this.spotted=!0,this.sprite.setVelocity(0)}update(){if(this.spotted||this.busy)return;const{sprite:t,speed:e,joystick:s,cursors:i}=this;let n=0,a=0;t.setVelocity(0);var r=s.left,o=s.right,h=s.up,l=s.down;s.force>0?(r?n=-e:o&&(n=e),h?a=-e:l&&(a=e)):(i.left.isDown?n=-e:i.right.isDown&&(n=e),i.up.isDown?a=-e:i.down.isDown&&(a=e)),t.setVelocity(n,a),0==n&&0==a||this.running.isPlaying||this.running.play({loop:!0}),n>0?(t.play("run-right",!0),this.lastDirection="right"):n<0?(t.play("run-left",!0),this.lastDirection="left"):0!==a?"right"===this.lastDirection?t.play("run-right",!0):t.play("run-left",!0):(this.running.stop(),"right"===this.lastDirection?t.play("stand-right",!0):t.play("stand-left",!0))}stop(){this.running.stop()}destroy(){this.sprite.destroy(),this.joystick&&this.joystick.destroy()}madDash(){this.maddashUsesLeft>0&&!this.dashing&&(this.maddashUsesLeft--,this.speed*=2,this.madDashText.setText(`Mad dash: ${this.maddashUsesLeft} left`),this.dashing=!0,this.dashingTone.isPlaying||this.dashingTone.play(),setTimeout((()=>{this.speed/=2,this.dashing=!1}),1e3))}pretendBusy(){this.pretendBusyUsesLeft>0&&!this.busy&&(console.log(this),this.busy=!0,this.pretendBusyUsesLeft--,this.pretendBusyText.setText(`Pretend busy: ${this.pretendBusyUsesLeft} left`),this.sprite.setVelocity(0),this.running.stop(),"right"===this.lastDirection?this.sprite.play("stand-right",!0):this.sprite.play("stand-left",!0),this.busyTone.isPlaying||this.busyTone.play(),setTimeout((()=>{this.busy=!1}),1e3))}}class c{constructor(t,e){this.scene=t,this.timeLeft=e,this.timerText=t.add.text(t.scale.width-20,20,"",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(1,0).setScrollFactor(0),this.countdownEvent=t.time.addEvent({delay:1e3,callback:this.update,callbackScope:this,loop:!0});const s=Math.floor(this.timeLeft/60),i=this.timeLeft%60;this.timerText.setText(`${s}:${i.toString().padStart(2,"0")}`)}update(){if(this.timeLeft>0){this.timeLeft--;const t=Math.floor(this.timeLeft/60),e=this.timeLeft%60;this.timerText.setText(`${t}:${e.toString().padStart(2,"0")}`)}else this.countdownEvent.remove(),this.timerText.setText("00:00"),this.scene.scene.start("GameOver")}}class u{constructor(t,e,s,i,n,a,r,o=[]){this.wallLayer=e,this.scene=t,this.speed=300,this.width=120,this.height=120,this.pathPoints=o,this.detected=!1,this.currentTargetIndex=0,this.facingAngle=0,this.targetAngle=0,this.angleLerpSpeed=5,this.sprite=t.physics.add.sprite(s,i,`run-left-${a}`),this.detectionCount=0,this.maxDetectionCount=30,this.soundCount=0,this.maxSoundCount=40,this.video_name=r,this.debugBox=this.scene.add.graphics(),this.debugBox.setDepth(10),this.sprite.anims.create({key:`run-left-${a}`,frames:this.scene.anims.generateFrameNames(`run-left-${a}`,{prefix:"Walking_",start:0,end:19,zeroPad:5}),frameRate:25,repeat:-1}),this.sprite.anims.create({key:`run-right-${a}`,frames:this.scene.anims.generateFrameNames(`run-right-${a}`,{prefix:"Walking_",start:0,end:19,zeroPad:5}),frameRate:25,repeat:-1}),this.sprite.setDepth(1),this.sprite.setCollideWorldBounds(!0),this.sprite.setDisplaySize(this.width,this.height),this.visionGraphics=this.scene.add.graphics({fillStyle:{color:16777215,alpha:.25}}),this.visionGraphics.setDepth(1),this.caughtSound=t.sound.add(n,{loop:!1,spatial:!0}),this.detectedSound=t.sound.add(n,{loop:!1,spatial:!0}),this.detectedSound.once("complete",(()=>{h.emit("player-spotted-ended",{npc:this})})),this.scene.input.once("pointerdown",(()=>{this.detectedSound.isPlaying&&(this.detectedSound.stop(),h.emit("player-spotted-ended",{npc:this}))})),this.steps=t.sound.add("steps",{loop:!0,spatial:!0}),this.prevPosition=new Phaser.Math.Vector2(s,i),this.stuckTime=0,this.maxStuckTime=1e3,this.npc_name=a}drawVisionCone(t,e,s,i,n){this.visionGraphics.clear();const a=Phaser.Math.Clamp(this.detectionCount/this.maxDetectionCount,0,1);let r=228,o=106,h=142;if(a<=.5){const t=a/.5;r=228,o=106,h=Math.floor(228*(1-t))}else{const t=(a-.5)/.5;r=228,o=Math.floor(106*(1-t)),h=0}const l=r<<16|o<<8|h;this.visionGraphics.fillStyle(l,.3);const d=Phaser.Math.DegToRad(s),c=Phaser.Math.DegToRad(n),u=d-c/2,p=d+c/2;this.visionGraphics.beginPath(),this.visionGraphics.moveTo(t,e);for(let m=u;m<=p;m+=.05){const s=4;let n=t,a=e;for(let r=0;r<i;r+=s){n=t+r*Math.cos(m),a=e+r*Math.sin(m);const s=this.wallLayer.getTileAtWorldXY(n,a,!0);if(s&&s.collides)break}this.visionGraphics.lineTo(n,a)}this.visionGraphics.lineTo(t,e),this.visionGraphics.closePath(),this.visionGraphics.fillPath()}isPlayerInCone(t,e,s,i,n){if(e.busy)return;const a=e.sprite.x-t.x,r=e.sprite.y-t.y;if(Math.hypot(a,r)>i)return!1;const o=Phaser.Math.RadToDeg(Math.atan2(r,a)),h=s,l=Phaser.Math.Angle.WrapDegrees(o-h);if(Math.abs(l)>n/2)return!1;const d=new Phaser.Math.Vector2(t.x,t.y),c=new Phaser.Math.Vector2(e.sprite.x,e.sprite.y),u=new Phaser.Geom.Line(d.x,d.y,c.x,c.y);return!(this.wallLayer.getTilesWithinShape(u,{isColliding:!0}).length>0)}disableInput(){this.detected=!0,this.sprite.setVelocity(0),this.steps.stop(),this.sprite.stop(`run-right-${this.npc_name}`),this.visionGraphics.clear()}update(){if(this.detected)return;const t=this.sprite;if(this.scene.player.busy||this.drawVisionCone(t.x,t.y,this.facingAngle,280,360),this.isPlayerInCone(t,this.scene.player,this.facingAngle,500,360,this.scene.objects)?this.soundCount++:this.soundCount>0&&this.soundCount--,this.isPlayerInCone(t,this.scene.player,this.facingAngle,280,360,this.scene.objects)?this.detectionCount++:this.detectionCount>0&&this.detectionCount--,this.soundCount>=this.maxSoundCount&&(this.caughtSound.isPlaying||this.caughtSound.play({loop:!1})),this.detectionCount>=this.maxDetectionCount)return this.detected=!0,this.sprite.setVelocity(0,0),void this.scene.scene.start("CutsceneScene",{video_name:this.video_name});if(0===this.pathPoints.length)return;const e=this.pathPoints[this.currentTargetIndex],s=e.x-t.x,i=e.y-t.y,n=Math.hypot(s,i);if(n<4)return void(this.currentTargetIndex=(this.currentTargetIndex+1)%this.pathPoints.length);const a=i/n;var r=s/n*this.speed,o=a*this.speed;t.setVelocity(r,o),n>1&&(this.targetAngle=Phaser.Math.RadToDeg(Math.atan2(i,s)));let h=Phaser.Math.Angle.WrapDegrees(this.targetAngle-this.facingAngle);this.facingAngle+=Phaser.Math.Clamp(h,-this.angleLerpSpeed,this.angleLerpSpeed),r>0?(t.play(`run-right-${this.npc_name}`,!0),this.lastDirection="right"):r<0?(t.play(`run-left-${this.npc_name}`,!0),this.lastDirection="left"):0!==o?"right"===this.lastDirection?t.play(`run-right-${this.npc_name}`,!0):t.play(`run-left-${this.npc_name}`,!0):(this.running.stop(),"right"===this.lastDirection?t.play("stand-right",!0):t.play("stand-left",!0)),this.scene.time.now;const l=this.sprite.getCenter();return Phaser.Math.Distance.BetweenPoints(l,this.prevPosition)<2?this.stuckTime+=this.scene.game.loop.delta:this.stuckTime=0,this.prevPosition.copy(l),this.stuckTime>this.maxStuckTime?(this.currentTargetIndex=(this.currentTargetIndex+1)%this.pathPoints.length,void(this.stuckTime=0)):void 0}stop(){this.steps.stop()}destroy(){this.sprite.destroy()}}class p extends s.Scene{constructor(){super("FloorScene"),this.npcs=[],this.objectives=[],this.zones=[],this.uiElements={checkboxes:[],texts:[]}}create(){h.setScene(this),h.once("floor-cleared",(()=>{this.handleFloorClear()})),h.once("game-won",(()=>{this.stopAllAudio()})),h.once("player-spotted",(()=>{console.log("Player spotted! Switching to GameOverScene..."),this.stopAllAudio(),this.player.disableInput(),this.npcs.forEach((t=>t.disableInput()))})),h.once("player-spotted-ended",(()=>{this.stopAllAudio(),h.emit("game-over",{score:0}),this.scene.start("GameOver",{score:0})})),h.once("floor-started",(t=>{console.log(t),this.stopAllAudio(),this.scene.restart({floor:t.floor})})),this.successTone=this.sound.add("success",{loop:!1})}handleFloorClear(){this.cameras.main.fadeOut(500),h.pretendBusyUses=this.player.pretendBusyUsesLeft,h.madDashUses=this.player.maddashUsesLeft,this.time.delayedCall(1e3,(()=>{this.stopAllAudio(),h.nextFloor()}))}init(t){this.npcs=[],this.objectives=[],this.zones=[],this.uiElements={checkboxes:[],texts:[]},this.floor=t.floor||h.floor;let e=h.getFloorData(this.floor);console.log(e),this.npcs=[],this.objectives=[],e.objectives&&(this.objectives=e.objectives.map((t=>({...t,complete:!1})))),this.map=this.make.tilemap({key:e.mapkey});const s=this.map.addTilesetImage("main_tailset","tiles"),i=this.map.createLayer("main",s,0,0),n=this.map.createLayer("objects",s,0,0);n.setCollisionByProperty({collides:!0}),this.player=new d(this,e.player.x,e.player.y);const a=[],r=[];let o=1;e.npcs.forEach((t=>{const e=this.map.findObject("npcs",(t=>t.name===`npc${o}`)),s=e.polygon.map((t=>({x:t.x+e.x,y:t.y+e.y})));let i=new u(this,n,s[0].x,s[0].y,t.sound,t.npc_name,t.video_name,s);this.npcs.push(i),a.push(i.sprite),this.physics.add.collider(i.sprite,n),r.push(i.visionGraphics),o++})),this.physics.add.collider(this.player.sprite,n),this.uiCamera=this.cameras.add(0,0,this.scale.width,this.scale.height),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.cameras.main.startFollow(this.player.sprite);const l=this.scale.height/1e3;this.cameras.main.setZoom(l),this.cameras.main.roundPixels=!0,this.cameras.main.ignore([this.player.joystickBase,this.player.joystickThumb]),this.timer=new c(this,e.timer),this.uiCamera.ignore([i,n,this.player.sprite,...a,...r]),this.bgm=this.sound.add(e.backgroundmusic,{loop:!0,volume:.7}),this.bgm.play();const p=this.map.findObject("objects",(t=>"exit"===t.name));this.objectives.forEach((t=>{const e=this.map.findObject("objects",(e=>e.name===t.key));if(e){var s=this.add.zone(e.x,e.y,e.width,e.height);this.zones.push(s),this.physics.add.existing(s),s.body.setAllowGravity(!1),s.body.setImmovable(!0),this.physics.add.overlap(this.player.sprite,s,(()=>{this.objectives.forEach((e=>{e.key!==t.key||e.complete||(this.successTone.play(),e.complete=!0)}))}))}})),this.exitZone=this.add.zone(p.x,p.y,p.width,p.height),this.physics.add.existing(this.exitZone),this.exitZone.body.setAllowGravity(!1),this.exitZone.body.setImmovable(!0),this.physics.add.overlap(this.player.sprite,this.exitZone,(()=>{var t=!0;if(this.objectives.length>0)for(var e=0;e<this.objectives.length;e++)if(!this.objectives[e].complete&&this.objectives[e].required){t=!1;break}if(t){let t=this.calculateScore(!0);h.emit("floor-cleared",{score:t})}})),this.uiContainer=this.add.container(0,0),this.uiContainer.setScrollFactor(0),this.createUiElements()}update(){this.player.update(),this.npcs.forEach((t=>t.update())),this.renderUi()}stopAllAudio(){this.sound.stopAll()}destroy(){this.bgm.stop()}createUiElements(){this.objectives&&this.objectives.forEach(((t,e)=>{const s=this.add.image(100,130*(e+1),"checkbox_off").setAlpha(1);s.setOrigin(.5);var i=t.title;t.required||(i+=" (Optional)");const n=this.add.text(140,130*(e+1),i,{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"left"}).setOrigin(0,.5);this.uiContainer.add([s,n]),this.uiElements.checkboxes.push(s),this.uiElements.texts.push(n)}))}renderUi(){this.objectives&&this.uiElements.checkboxes.length>0&&this.objectives.forEach(((t,e)=>{const s=this.uiElements.checkboxes[e],i=this.uiElements.texts[e];s.setTexture(t.complete?"checkbox_on":"checkbox_off"),t.complete?i.setColor("#00ff00"):i.setColor("#ffffff")}))}calculateScore(t){let e=0;return t&&(this.objectives&&this.uiElements.checkboxes.length>0&&this.objectives.forEach((t=>{t.complete&&(e+=t.score)})),e+=Math.ceil(10*this.timer.timeLeft/3)),e}}class m extends s.Scene{constructor(){super("MainMenu")}create(){this.add.image(0,0,"mainmenu").setDisplaySize(this.scale.width,this.scale.height).setOrigin(0,0).setScrollFactor(0);const t=this.scale.width/1.38,e=.64*this.scale.height;this.add.zone(.95*t,e,1400,370).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{document.getElementById("nameInput")||this.showNameInput()}));const s=.88*this.scale.height;this.add.zone(t,s,1400,370).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.scene.start("LeaderboardScene")})),this.menuMusic=this.sound.add("main_menu_m",{loop:!0}),this.menuMusic.play(),this.events.on("shutdown",this.stopMenuMusic,this),this.events.on("destroy",this.stopMenuMusic,this)}stopMenuMusic(){this.menuMusic&&this.menuMusic.stop()}showNameInput(){if(localStorage.getItem("username"))h.startGame(this);else{const t=document.createElement("div");if(t.id="nameContainer",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.background="rgba(255, 255, 255)",t.style.padding="40px",t.style.borderRadius="16px",t.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)",t.style.textAlign="center",t.style.zIndex=1e3,t.style.fontFamily="'Cairo', sans-serif",t.style.minWidth="300px",!document.getElementById("googleFont")){const t=document.createElement("link");t.id="googleFont",t.href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap",t.rel="stylesheet",document.head.appendChild(t)}const e=document.createElement("div");e.textContent="هات اسمك لو سمحت",e.style.fontSize="22px",e.style.marginBottom="15px",e.style.color="#333";const s=document.createElement("input");s.id="name",s.dir="rtl",s.type="text",s.placeholder="",s.style.width="100%",s.style.padding="12px",s.style.border="1px solid #ccc",s.style.borderRadius="8px",s.style.fontSize="18px",s.style.marginBottom="20px",s.style.fontFamily="inherit";const i=document.createElement("button");i.textContent="ابدأ اللعبة",i.style.backgroundColor="#e53935",i.style.color="white",i.style.border="none",i.style.padding="12px 24px",i.style.borderRadius="8px",i.style.fontSize="18px",i.style.cursor="pointer",i.style.fontFamily="inherit",i.onclick=()=>{const e=s.value.trim();e.length>0?(localStorage.setItem("username",e),t.remove(),h.startGame(this)):alert("من فضلك أدخل اسمك!")},t.appendChild(e),t.appendChild(s),t.appendChild(i),document.body.appendChild(t)}}}class y extends s.Scene{constructor(){super("GameWon")}create(t){const{width:e,height:s}=this.scale;this.sound.stopAll();const i=this.add.video(e/2,s/2,"win");i.setMute(!1),i.setVolume(1),i.play(!1),i.once("complete",(()=>{i.pause(),this.input.once("pointerdown",(()=>{i.stop(),this.scene.start("MainMenu")}))}))}}class g extends s.Scene{constructor(){super("Preloader")}init(){this.add.rectangle(1920,1080,1404,64).setStrokeStyle(2,16777215);const t=this.add.rectangle(1222,1080,8,56,16777215);this.load.on("progress",(e=>{t.width=8+1396*e}))}preload(){this.load.setPath("assets"),this.load.image("mainmenu","Main.png"),this.load.image("logo","logo.png"),this.load.image("checkbox_off","checkbox_off.png"),this.load.image("checkbox_on","checkbox_on.png"),this.load.image("phone","phone.png"),this.load.image("run","run.png"),this.load.audio("running","audio/FOOTSTEPS.wav"),this.load.audio("steps","audio/FOOTSTEPS.wav"),this.load.image("tiles","maps/spritesheet.png"),this.load.tilemapTiledJSON("floor1","maps/floor1.json"),this.load.tilemapTiledJSON("floor2","maps/floor2.json"),this.load.tilemapTiledJSON("floor3","maps/floor3.json"),this.load.atlas("soldier","animations/soldier/soldier.png","animations/soldier/soldier.json"),this.load.atlas("stand-right","animations/mainPlayer/StandingRight.png","animations/mainPlayer/StandingRight.json"),this.load.atlas("stand-left","animations/mainPlayer/StandingLeft.png","animations/mainPlayer/StandingLeft.json"),this.load.atlas("run-left","animations/mainPlayer/RunningLeft.png","animations/mainPlayer/RunningLeft.json"),this.load.atlas("run-right","animations/mainPlayer/RunningRight.png","animations/mainPlayer/RunningRight.json"),this.load.atlas("run-left-farah","animations/Farah/FarahWalkingLeft.png","animations/Farah/FarahWalkingLeft.json"),this.load.atlas("run-right-farah","animations/Farah/FarahWalkingRight.png","animations/Farah/FarahWalkingRight.json"),this.load.atlas("run-left-karam","animations/Karam/KaramWalkingLeft.png","animations/Karam/KaramWalkingLeft.json"),this.load.atlas("run-right-karam","animations/Karam/KaramWalkingRight.png","animations/Karam/KaramWalkingRight.json"),this.load.atlas("run-left-tala","animations/Tala/TalaWalkingLeft.png","animations/Tala/TalaWalkingLeft.json"),this.load.atlas("run-right-tala","animations/Tala/TalaWalkingRight.png","animations/Tala/TalaWalkingRight.json"),this.load.atlas("run-left-rida","animations/Rida/RidaWalkingLeft.png","animations/Rida/RidaWalkingLeft.json"),this.load.atlas("run-right-rida","animations/Rida/RidaWalkingRight.png","animations/Rida/RidaWalkingRight.json"),this.load.atlas("run-left-yasser","animations/Yasser/YasserWalkingLeft.png","animations/Yasser/YasserWalkingLeft.json"),this.load.atlas("run-right-yasser","animations/Yasser/YasserWalkingRight.png","animations/Yasser/YasserWalkingRight.json"),this.load.audio("bgm","audio/Main game music.mp3"),this.load.audio("main_menu_m","audio/Main menu music.mp3"),this.load.audio("Rida","audio/Rida.mp3"),this.load.audio("Tala","audio/Tala.mp3"),this.load.audio("Karam","audio/Karam.mp3"),this.load.audio("Farah","audio/Farah.mp3"),this.load.audio("Yasser","audio/Yasser.mp3"),this.load.audio("success","audio/objective done.mp3"),this.load.audio("vocal_cute_angry","audio/Vibrant_UI_Mouse_Click_1.wav"),this.load.audio("dashing","audio/Vibrant_UI_Mouse_Click_1.wav"),this.load.audio("game_over","audio/Game Over.mp3"),this.load.audio("win","audio/win.wav"),this.load.video("farah_cutscene","cutscenes/farah_cutscene.mp4","loadeddata",!1,!0),this.load.video("tala_cutscene","cutscenes/tala_cutscene.mp4","loadeddata",!1,!0),this.load.video("karam_cutscene","cutscenes/karam_cutscene.mp4","loadeddata",!1,!0),this.load.video("yasser_cutscene","cutscenes/yasser_cutscene.mp4","loadeddata",!1,!0),this.load.video("rida_cutscene","cutscenes/rida_cutscene.mp4","loadeddata",!1,!0),this.load.video("splash_video","video/Splash screen.mp4","loadeddata",!1,!0),this.load.video("win","video/wininng screen.mp4","loadeddata",!1,!0)}create(){this.scene.start("SplashScene")}}class f extends s.Scene{constructor(){super("CutsceneScene")}create(t){const{width:e,height:s}=this.scale;this.sound.stopAll();const i=(null==t?void 0:t.video_name)||"karam_cutscene",n=this.add.video(e/2,s/2,i);n.setMute(!1),n.setVolume(1),n.play(!1),n.once("complete",(()=>{n.pause(),this.input.once("pointerdown",(()=>{n.stop(),this.scene.start("MainMenu")}))}))}}class v extends s.Scene{constructor(){super("SplashScene")}create(){const{width:t,height:e}=this.scale,s=this.add.video(t/2,e/2,"splash_video");s.play(),s.once("complete",(()=>{this.scene.start("MainMenu")}))}}class b extends s.Scene{constructor(){super("LeaderboardScene")}create(){const t=1920;this.add.text(t,580,"Leaderboard",{fontSize:"128px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);const e=this.add.text(t,780,"Loading...",{fontSize:"80px",color:"#ffff99",fontFamily:"Arial"}).setOrigin(.5);fetch("https://159.89.49.190:3000/api/v1/leaderboard/").then((t=>t.json())).then((s=>{if(e.destroy(),"success"===s.status&&Array.isArray(s.data)){const e=s.data.sort(((t,e)=>parseInt(e.score)-parseInt(t.score))).slice(0,5);0===e.length?this.add.text(t,880,"No scores yet!",{fontSize:"64px",color:"#ffaaaa",fontFamily:"Arial"}).setOrigin(.5):e.forEach(((e,s)=>{this.add.text(t,880+120*s,`${s+1}. ${e.username} - ${e.score}`,{fontSize:"80px",color:"#ffff99",fontFamily:"Arial"}).setOrigin(.5)}))}else this.add.text(t,880,"Failed to load leaderboard.",{fontSize:"64px",color:"#ffaaaa",fontFamily:"Arial"}).setOrigin(.5)})).catch((()=>{e.destroy(),this.add.text(t,880,"Error loading leaderboard.",{fontSize:"64px",color:"#ffaaaa",fontFamily:"Arial"}).setOrigin(.5)}));const s=this.add.rectangle(t,1580,600,120,2236996).setInteractive({useHandCursor:!0});this.add.text(t,1580,"Return to Main Menu",{fontSize:"64px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5),s.on("pointerdown",(()=>{this.scene.start("MainMenu")}))}}const x=Phaser.Input.Keyboard.Key,k=Phaser.Input.Keyboard.KeyCodes,w=["up","down","left","right"];class S{constructor(t){this.scene=t,this.keys={},this.cursorKeys={},this.noKeyDown=!0;for(var e=0,s=w.length;e<s;e++){var i=w[e];this.addKey(i),this.cursorKeys[i]=this.keys[i]}}shutdown(t){for(var e in this.scene=void 0,this.keys)this.keys[e].destroy();this.keys=void 0,this.cursorKeys=void 0}destroy(t){shutdown(t)}createCursorKeys(){return this.cursorKeys}setKeyState(t,e){var s=this.keys[t];return s.enabled?(e&&(this.noKeyDown=!1),s.isDown!==e&&(_.timeStamp=Date.now(),_.keyCode=s.keyCode,e?s.onDown(_):s.onUp(_)),this):this}clearAllKeysState(){for(var t in this.noKeyDown=!0,this.keys)this.setKeyState(t,!1);return this}getKeyState(t){return this.keys[t]}get upKeyDown(){return this.keys.up.isDown}get downKeyDown(){return this.keys.down.isDown}get leftKeyDown(){return this.keys.left.isDown}get rightKeyDown(){return this.keys.right.isDown}get anyKeyDown(){return!this.noKeyDown}addKey(t,e){return void 0===e&&(e=t),"string"==typeof e&&(e=e.toUpperCase(),k.hasOwnProperty(e)&&(e=k[e])),this.keys[t]=new x(this.scene,e),this}addKeys(t){for(var e=0,s=t.length;e<s;e++)this.addKey(t[e]);return this}}var _={timeStamp:0,keyCode:0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,location:0},E=180/Math.PI;const C={"up&down":0,"left&right":1,"4dir":2,"8dir":3};var T={};const D=Phaser.Utils.Objects.GetValue,P=Phaser.Math.Distance.Between,M=Phaser.Math.Angle.Between;class F extends S{constructor(t,e){super(t),this.resetFromJSON(e)}resetFromJSON(t){null==this.start&&(this.start={x:0,y:0}),null==this.end&&(this.end={x:0,y:0}),this._enable=void 0,this.setEnable(D(t,"enable",!0)),this.setMode(D(t,"dir","8dir")),this.setDistanceThreshold(D(t,"forceMin",16));var e=D(t,"start.x",null),s=D(t,"start.y",null),i=D(t,"end.x",null),n=D(t,"end.y",null);return this.setVector(e,s,i,n),this}toJSON(){return{enable:this.enable,dir:this.dirMode,forceMin:this.forceMin,start:{x:this.start.x,y:this.start.y},end:{x:this.end.x,y:this.end.y}}}setMode(t){return"string"==typeof t&&(t=C[t]),this.dirMode=t,this}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.clearVector(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}setDistanceThreshold(t){return t<0&&(t=0),this.forceMin=t,this}clearVector(){return this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.clearAllKeysState(),this}setVector(t,e,s,i){if(!this.enable)return this;if(null===t)return this.clearVector(),this;if(void 0===s&&(s=t,t=0,i=e,e=0),this.start.x=t,this.start.y=e,this.end.x=s,this.end.y=i,this.forceMin>0&&this.force<this.forceMin)return this.clearVector(),this;this.noKeyDown=!0;var n=function(t,e,s){switch(void 0===s?s={}:!0===s&&(s=T),s.left=!1,s.right=!1,s.up=!1,s.down=!1,t=(t+360)%360,e){case 0:t<180?s.down=!0:s.up=!0;break;case 1:t>90&&t<=270?s.left=!0:s.right=!0;break;case 2:t>45&&t<=135?s.down=!0:t>135&&t<=225?s.left=!0:t>225&&t<=315?s.up=!0:s.right=!0;break;case 3:t>22.5&&t<=67.5?(s.down=!0,s.right=!0):t>67.5&&t<=112.5?s.down=!0:t>112.5&&t<=157.5?(s.down=!0,s.left=!0):t>157.5&&t<=202.5?s.left=!0:t>202.5&&t<=247.5?(s.left=!0,s.up=!0):t>247.5&&t<=292.5?s.up=!0:t>292.5&&t<=337.5?(s.up=!0,s.right=!0):s.right=!0}return s}(this.angle,this.dirMode,!0);for(var a in n)this.setKeyState(a,n[a]);return this}get forceX(){return this.end.x-this.start.x}get forceY(){return this.end.y-this.start.y}get force(){return P(this.start.x,this.start.y,this.end.x,this.end.y)}get rotation(){return M(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return this.rotation*E}get octant(){var t=0;return this.rightKeyDown?t=this.downKeyDown?45:0:this.downKeyDown?t=this.leftKeyDown?135:90:this.leftKeyDown?t=this.upKeyDown?225:180:this.upKeyDown&&(t=this.rightKeyDown?315:270),t}}const j={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};var K={};const O=Phaser.Utils.Objects.GetValue,L=Phaser.Geom.Circle,A=Phaser.Geom.Circle.Contains;class R extends F{constructor(t,e){var s=t.scene;super(s,e);var i=O(e,"eventEmitter",void 0),n=O(e,"EventEmitterClass",void 0);this.setEventEmitter(i,n),this.scene=s,this.mainCamera=s.sys.cameras.main,this.pointer=void 0,this.gameObject=t,this.radius=O(e,"radius",100),t.setInteractive(new L(t.displayOriginX,t.displayOriginY,this.radius),A),this.boot()}resetFromJSON(t){return super.resetFromJSON(t),this.pointer=void 0,this}toJSON(){var t=super.toJSON();return t.radius=this.radius,t}boot(){this.gameObject.on("pointerdown",this.onKeyDownStart,this),this.gameObject.on("pointerover",this.onKeyDownStart,this),this.scene.input.on("pointermove",this.onKeyDown,this),this.scene.input.on("pointerup",this.onKeyUp,this),this.gameObject.once("destroy",this.onParentDestroy,this)}shutdown(t){this.scene&&(this.scene.input.off("pointermove",this.onKeyDown,this),this.scene.input.off("pointerup",this.onKeyUp,this),this.destroyEventEmitter(),this.scene=void 0,this.mainCamera=void 0,this.pointer=void 0,this.gameObject=void 0,super.shutdown())}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||(this.pointer=void 0),super.enable=t,this}destroy(t){this.shutdown(t)}onParentDestroy(t,e){this.destroy(e)}onKeyDownStart(t){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.onKeyDown(t),this.emit("pointerdown",t))}onKeyDown(t){if(this.pointer===t){var e=function(t,e,s){var i=t.camera;return i?(void 0===s?s={}:!0===s&&(s=K),i===e?(s.x=t.worldX,s.y=t.worldY):i.getWorldPoint(t.x,t.y,s),s):null}(t,this.mainCamera,!0);if(e){var s=t.camera,i=this.gameObject,n=i.x-s.scrollX*(i.scrollFactorX-1),a=i.y-s.scrollY*(i.scrollFactorY-1);this.setVector(n,a,e.x,e.y),this.end.x=e.x,this.end.y=e.y,this.emit("update")}}}onKeyUp(t){this.pointer===t&&(this.pointer=void 0,this.clearVector(),this.emit("update"),this.emit("pointerup",t))}forceUpdate(){var t=this.pointer;return t&&t.isDown?(this.onKeyDown(t),this):this}}Object.assign(R.prototype,j);const G=Phaser.Utils.Objects.GetValue;class B{constructor(t,e){void 0===e&&(e={});var s=G(e,"eventEmitter",void 0),i=G(e,"EventEmitterClass",void 0);this.setEventEmitter(s,i),e.eventEmitter=this.getEventEmitter(),this.scene=t,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0,this.setRadius(G(e,"radius",100)),this.addBase(G(e,"base",void 0),e),this.addThumb(G(e,"thumb",void 0));var n=G(e,"x",0),a=G(e,"y",0);this.base.setPosition(n,a),this.thumb.setPosition(n,a),G(e,"fixed",!0)&&this.setScrollFactor(0),this.boot()}destroy(){this.destroyEventEmitter(),this.base.destroy(),this.thumb.destroy(),this.scene=void 0,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0}createCursorKeys(){return this.touchCursor.createCursorKeys()}get forceX(){return this.touchCursor.forceX}get forceY(){return this.touchCursor.forceY}get force(){return this.touchCursor.force}get rotation(){return this.touchCursor.rotation}get angle(){return this.touchCursor.angle}get up(){return this.touchCursor.upKeyDown}get down(){return this.touchCursor.downKeyDown}get left(){return this.touchCursor.leftKeyDown}get right(){return this.touchCursor.rightKeyDown}get noKey(){return this.touchCursor.noKeyDown}get pointerX(){return this.touchCursor.end.x}get pointerY(){return this.touchCursor.end.y}get pointer(){return this.touchCursor.pointer}setPosition(t,e){return this.x===t&&this.y===e||(this.x=t,this.y=e,this.forceUpdateThumb()),this}set x(t){this.x!==t&&(this.base.x=t,this.thumb.x=t)}set y(t){this.y!==t&&(this.base.y=t,this.thumb.y=t)}get x(){return this.base.x}get y(){return this.base.y}setVisible(t){return this.visible=t,this}toggleVisible(){return this.visible=!this.visible,this}get visible(){return this.base.visible}set visible(t){this.base.visible=t,this.thumb.visible=t,this.enable=t}get enable(){return this.touchCursor.enable}set enable(t){this.touchCursor.setEnable(t)}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}setRadius(t){return this.radius=t,this}addBase(t,e){return this.base&&this.base.destroy(),void 0===t&&(t=this.scene.add.circle(0,0,this.radius).setStrokeStyle(3,255)),void 0===e&&(e={}),e.eventEmitter=this.getEventEmitter(),this.touchCursor=new R(t,e),this.base=t,this}addThumb(t){return this.thumb&&this.thumb.destroy(),void 0===t&&(t=this.scene.add.circle(0,0,40).setStrokeStyle(3,65280)),this.thumb=t,this}setScrollFactor(t){return this.base.setScrollFactor(t),this.thumb.setScrollFactor(t),this}boot(){this.on("update",this.update,this)}update(){var t,e,s=this.touchCursor,i=s.dirMode;if(s.anyKeyDown)if(s.force>this.radius){var n=s.rotation;t=0!==i?Math.cos(n)*this.radius:0,e=1!==i?Math.sin(n)*this.radius:0}else t=0!==i?s.forceX:0,e=1!==i?s.forceY:0;else t=0,e=0;return this.thumb.x=this.base.x+t,this.thumb.y=this.base.y+e,this}forceUpdateThumb(){return this.touchCursor.forceUpdate(),this}}Object.assign(B.prototype,j);class I extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.on("destroy",this.destroy,this)}add(t,e){return new B(t,e)}addVectorToCursorKeys(t){return new F(void 0,t)}}const U={type:s.AUTO,width:3840,height:2160,parent:"game-container",backgroundColor:"#000000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},pixelArt:!0,render:{antialias:!1},physics:{default:"arcade"},scene:[n,g,m,a,p,l,y,b,f,v],plugins:{global:[{key:"rexVirtualJoystick",plugin:I,start:!0}]}};document.addEventListener("DOMContentLoaded",(()=>{new s.Game({...U,parent:"game-container"})}));
